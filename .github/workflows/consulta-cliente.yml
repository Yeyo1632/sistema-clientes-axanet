name: ğŸ” Consulta de InformaciÃ³n de Cliente
description: Flujo automatizado para registrar y notificar consultas de informaciÃ³n de clientes

on:
  workflow_dispatch:
    inputs:
      nombre_cliente:
        description: 'Nombre del cliente consultado'
        required: true
        type: string
      id_cliente:
        description: 'ID del cliente (opcional)'
        required: false
        type: string
      tipo_consulta:
        description: 'Tipo de informaciÃ³n consultada'
        required: true
        type: choice
        options:
        - InformaciÃ³n general del cliente
        - Historial de servicios
        - Datos de contacto y facturaciÃ³n
        - Estado de cuenta y pagos
        - Contratos y documentos
        - Servicios activos y configuraciÃ³n
        - Todas las informaciÃ³n disponible
      motivo_consulta:
        description: 'Motivo de la consulta'
        required: true
        type: choice
        options:
        - Soporte al cliente
        - ActualizaciÃ³n de informaciÃ³n
        - RevisiÃ³n de contrato
        - AnÃ¡lisis de servicios
        - AuditorÃ­a interna
        - Requerimiento legal
        - Otro
      consultado_por:
        description: 'Departamento que realiza la consulta'
        required: true
        type: choice
        options:
        - Servicio al Cliente
        - Ventas
        - Soporte TÃ©cnico
        - Desarrollo
        - Finanzas
        - Legal
        - AdministraciÃ³n

jobs:
  registrar-consulta-cliente:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“Š Registrar consulta de cliente
        run: |
          echo "ğŸ” [CONSULTA DE CLIENTE]"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ‘¤ Cliente: ${{ github.event.inputs.nombre_cliente }}"
          echo "ğŸ†” ID: ${{ github.event.inputs.id_cliente || 'No especificado' }}"
          echo "ğŸ“‹ Tipo de consulta: ${{ github.event.inputs.tipo_consulta }}"
          echo "ğŸ¯ Motivo: ${{ github.event.inputs.motivo_consulta }}"
          echo "ğŸ¢ Departamento: ${{ github.event.inputs.consultado_por }}"
          echo "ğŸ‘¤ Consultado por: ${{ github.actor }}"
          echo "ğŸ“… Fecha y hora: $(date)"
          echo "â° Hora: $(date +%T)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
      - name: ğŸ“¢ Notificar equipos relevantes
        run: |
          echo "ğŸ“¤ NOTIFICANDO A EQUIPOS INVOLUCRADOS:"
          echo ""
          case "${{ github.event.inputs.consultado_por }}" in
            "Servicio al Cliente")
              echo "â€¢ ğŸ’¼ CustServTeam - @customer-success-axanet (PRIMARIO)"
              echo "â€¢ ğŸ“Š SalesTeam - @sales-axanet (SECUNDARIO)"
              ;;
            "Ventas")
              echo "â€¢ ğŸ“Š SalesTeam - @sales-axanet (PRIMARIO)"
              echo "â€¢ ğŸ’¼ CustServTeam - @customer-success-axanet (SECUNDARIO)"
              ;;
            "Soporte TÃ©cnico")
              echo "â€¢ ğŸ–¥ï¸  ITTeam - @it-support-axanet (PRIMARIO)"
              echo "â€¢ ğŸ‘¨â€ğŸ’» DevTeam - @dev-team-axanet (SECUNDARIO)"
              ;;
            "Desarrollo")
              echo "â€¢ ğŸ‘¨â€ğŸ’» DevTeam - @dev-team-axanet (PRIMARIO)"
              echo "â€¢ ğŸ–¥ï¸  ITTeam - @it-support-axanet (SECUNDARIO)"
              ;;
            "Finanzas")
              echo "â€¢ ğŸ’° FinanceTeam - @finance-axanet (PRIMARIO)"
              echo "â€¢ ğŸ’¼ CustServTeam - @customer-success-axanet (SECUNDARIO)"
              ;;
            "Legal")
              echo "â€¢ âš–ï¸  LegalTeam - @legal-axanet (PRIMARIO)"
              echo "â€¢ ğŸš¨ Management - @management-axanet (SECUNDARIO)"
              ;;
            "AdministraciÃ³n")
              echo "â€¢ ğŸ¢ AdminTeam - @admin-axanet (PRIMARIO)"
              echo "â€¢ ğŸš¨ Management - @management-axanet (SECUNDARIO)"
              ;;
          esac
          echo ""
          echo "ğŸ”” Tipo de acceso: CONSULTA"
          echo "ğŸ“Š Nivel de informaciÃ³n: ${{ github.event.inputs.tipo_consulta }}"
          
      - name: ğŸ“ Registrar en log de consultas
        run: |
          echo "ğŸ“‹ REGISTRO EN LOG DE CONSULTAS:"
          timestamp=$(date -Iseconds)
          echo "CONSULTA|${{ github.event.inputs.nombre_cliente }}|${{ github.event.inputs.id_cliente || 'N/A' }}|${{ github.event.inputs.tipo_consulta }}|${{ github.event.inputs.motivo_consulta }}|${{ github.event.inputs.consultado_por }}|${{ github.actor }}|$timestamp" >> consultas-clientes.log
          echo "âœ… Consulta registrada exitosamente"
          echo ""
          echo "ğŸ“ˆ EstadÃ­sticas de consulta:"
          echo "   â€¢ Cliente: ${{ github.event.inputs.nombre_cliente }}"
          echo "   â€¢ Tipo: ${{ github.event.inputs.tipo_consulta }}"
          echo "   â€¢ Departamento: ${{ github.event.inputs.consultado_por }}"
          echo "   â€¢ Registrado en: consultas-clientes.log"
          
      - name: ğŸ›¡ï¸ Verificar permisos y auditorÃ­a
        run: |
          echo "ğŸ” VERIFICACIÃ“N DE SEGURIDAD:"
          echo ""
          if [ "${{ github.event.inputs.tipo_consulta }}" = "Todas las informaciÃ³n disponible" ]; then
            echo "âš ï¸  CONSULTA COMPLETA - AUDITORÃA ACTIVADA"
            echo "   â€¢ Registro de seguridad elevado"
            echo "   â€¢ NotificaciÃ³n a supervisores"
            echo "   â€¢ RevisiÃ³n post-consulta requerida"
          elif [ "${{ github.event.inputs.motivo_consulta }}" = "Requerimiento legal" ]; then
            echo "âš–ï¸  CONSULTA LEGAL - PROCESO ESPECIAL"
            echo "   â€¢ DocumentaciÃ³n legal requerida"
            echo "   â€¢ NotificaciÃ³n a departamento legal"
            echo "   â€¢ Almacenamiento seguro activado"
          else
            echo "âœ… CONSULTA ESTÃNDAR - PERMISOS VÃLIDOS"
            echo "   â€¢ Acceso autorizado"
            echo "   â€¢ Registro estÃ¡ndar aplicado"
          fi
          
      - name: ğŸ“Š Generar resumen de consulta
        run: |
          echo "ğŸ“„ RESUMEN DE LA CONSULTA:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ” TIPO: ${{ github.event.inputs.tipo_consulta }}"
          echo "ğŸ¯ PROPÃ“SITO: ${{ github.event.inputs.motivo_consulta }}"
          echo "ğŸ¢ ORIGEN: ${{ github.event.inputs.consultado_por }}"
          echo ""
          echo "ğŸ“‹ INFORMACIÃ“N SOLICITADA:"
          case "${{ github.event.inputs.tipo_consulta }}" in
            "InformaciÃ³n general del cliente")
              echo "   â€¢ Datos bÃ¡sicos del cliente"
              echo "   â€¢ Fecha de registro"
              echo "   â€¢ Estado de la cuenta"
              ;;
            "Historial de servicios")
              echo "   â€¢ Servicios contratados"
              echo "   â€¢ Fechas de implementaciÃ³n"
              echo "   â€¢ Incidencias y soporte"
              ;;
            "Datos de contacto y facturaciÃ³n")
              echo "   â€¢ InformaciÃ³n de contacto"
              echo "   â€¢ Datos de facturaciÃ³n"
              echo "   â€¢ MÃ©todos de pago"
              ;;
            "Estado de cuenta y pagos")
              echo "   â€¢ Estado de cuenta"
              echo "   â€¢ Historial de pagos"
              echo "   â€¢ Facturas pendientes"
              ;;
            "Contratos y documentos")
              echo "   â€¢ Contratos vigentes"
              echo "   â€¢ Documentos legales"
              echo "   â€¢ Acuerdos de servicio"
              ;;
            "Servicios activos y configuraciÃ³n")
              echo "   â€¢ Servicios activos"
              echo "   â€¢ ConfiguraciÃ³n tÃ©cnica"
              echo "   â€¢ Recursos asignados"
              ;;
            "Todas las informaciÃ³n disponible")
              echo "   â€¢ TODOS los datos del cliente"
              echo "   â€¢ InformaciÃ³n completa"
              echo "   â€¢ Acceso total al historial"
              ;;
          esac
          echo ""
          echo "âœ… Consulta procesada y registrada"
