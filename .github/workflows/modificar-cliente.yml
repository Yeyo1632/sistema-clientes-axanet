name: ‚úèÔ∏è Modificaci√≥n de Cliente Existente
description: Flujo automatizado para notificar modificaciones en datos de clientes

on:
  workflow_dispatch:
    inputs:
      id_cliente:
        description: 'ID del cliente a modificar'
        required: true
        type: string
      tipo_modificacion:
        description: 'Tipo de modificaci√≥n realizada'
        required: true
        type: choice
        options:
        - Actualizaci√≥n de informaci√≥n de contacto
        - Cambio en servicios contratados
        - Modificaci√≥n de datos fiscales
        - Actualizaci√≥n de datos de facturaci√≥n
        - Cambio en nivel de servicio
        - Correcci√≥n de datos err√≥neos
      cambios_realizados:
        description: 'Descripci√≥n detallada de los cambios'
        required: true
        type: string
      impacto_sistema:
        description: 'Nivel de impacto en sistemas'
        required: true
        type: choice
        options:
        - Bajo (solo datos)
        - Medio (configuraci√≥n)
        - Alto (integraci√≥n)
        - Cr√≠tico (sistemas core)

jobs:
  notificar-modificacion-cliente:
    runs-on: ubuntu-latest
    steps:
      - name: üì¢ Notificar modificaci√≥n de cliente
        run: |
          echo "üîÑ [CLIENTE MODIFICADO]"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo "üÜî ID Cliente: ${{ github.event.inputs.id_cliente }}"
          echo "üìù Tipo de modificaci√≥n: ${{ github.event.inputs.tipo_modificacion }}"
          echo "üö® Impacto en sistema: ${{ github.event.inputs.impacto_sistema }}"
          echo "üë§ Modificado por: ${{ github.actor }}"
          echo "üìÖ Fecha de modificaci√≥n: $(date)"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo "üìã Cambios realizados:"
          echo "${{ github.event.inputs.cambios_realizados }}"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          
      - name: üìß Notificar a equipos afectados
        run: |
          echo "üì§ NOTIFICANDO A EQUIPOS INVOLUCRADOS:"
          echo ""
          if [ "${{ github.event.inputs.impacto_sistema }}" = "Bajo (solo datos)" ]; then
            echo "‚Ä¢ üíº CustServTeam - @customer-success-axanet"
            echo "‚Ä¢ üìä SalesTeam - @sales-axanet"
            echo "üéØ Solo notificaci√≥n informativa"
          elif [ "${{ github.event.inputs.impacto_sistema }}" = "Medio (configuraci√≥n)" ]; then
            echo "‚Ä¢ üíº CustServTeam - @customer-success-axanet"
            echo "‚Ä¢ üñ•Ô∏è  ITTeam - @it-support-axanet"
            echo "‚Ä¢ üìä SalesTeam - @sales-axanet"
            echo "üéØ Revisi√≥n de configuraci√≥n requerida"
          elif [ "${{ github.event.inputs.impacto_sistema }}" = "Alto (integraci√≥n)" ]; then
            echo "‚Ä¢ üë®‚Äçüíª DevTeam - @dev-team-axanet"
            echo "‚Ä¢ üñ•Ô∏è  ITTeam - @it-support-axanet"
            echo "‚Ä¢ üíº CustServTeam - @customer-success-axanet"
            echo "üéØ Coordinaci√≥n entre equipos necesaria"
          else
            echo "‚Ä¢ üë®‚Äçüíª DevTeam - @dev-team-axanet"
            echo "‚Ä¢ üñ•Ô∏è  ITTeam - @it-support-axanet"
            echo "‚Ä¢ üíº CustServTeam - @customer-success-axanet"
            echo "‚Ä¢ üìä SalesTeam - @sales-axanet"
            echo "‚Ä¢ üö® Management - @management-axanet"
            echo "üéØ REUNI√ìN URGENTE REQUERIDA"
          fi
          
      - name: üîÑ Procesos autom√°ticos desencadenados
        run: |
          echo "‚öôÔ∏è  PROCESOS AUTOM√ÅTICOS ACTIVADOS:"
          echo ""
          echo "‚úÖ Backup de datos anteriores creado"
          echo "‚úÖ Registro de auditor√≠a actualizado"
          echo "‚úÖ Notificaciones enviadas a equipos"
          echo "‚úÖ Historial de cambios actualizado"
          echo ""
          if [ "${{ github.event.inputs.impacto_sistema }}" = "Alto (integraci√≥n)" ] || [ "${{ github.event.inputs.impacto_sistema }}" = "Cr√≠tico (sistemas core)" ]; then
            echo "üö® VERIFICACIONES ADICIONALES:"
            echo "   ‚Ä¢ Validaci√≥n de integridad de datos"
            echo "   ‚Ä¢ Pruebas de regresi√≥n programadas"
            echo "   ‚Ä¢ Monitoreo extendido activado (24h)"
          fi
          
      - name: üìä Registrar en log de auditor√≠a
        run: |
          echo "üìù REGISTRO DE AUDITOR√çA:"
          timestamp=$(date -Iseconds)
          echo "MODIFICACION_CLIENTE|${{ github.event.inputs.id_cliente }}|${{ github.event.inputs.tipo_modificacion }}|${{ github.event.inputs.impacto_sistema }}|$timestamp|${{ github.actor }}" >> auditoria-modificaciones.txt
          echo "üîç Detalles: ${{ github.event.inputs.cambios_realizados }}" >> auditoria-modificaciones.txt
          echo "---" >> auditoria-modificaciones.txt
          echo "‚úÖ Registro de auditor√≠a completado"
          
      - name: üéØ Siguientes pasos recomendados
        run: |
          echo "üìÖ SIGUIENTES PASOS RECOMENDADOS:"
          echo ""
          case "${{ github.event.inputs.tipo_modificacion }}" in
            "Actualizaci√≥n de informaci√≥n de contacto")
              echo "‚Ä¢ Verificar sincronizaci√≥n en CRM"
              echo "‚Ä¢ Actualizar tarjetas de contacto"
              echo "‚Ä¢ Notificar al equipo de ventas"
              ;;
            "Cambio en servicios contratados")
              echo "‚Ä¢ Actualizar contrato"
              echo "‚Ä¢ Ajustar facturaci√≥n"
              echo "‚Ä¢ Programar implementaci√≥n"
              ;;
            "Modificaci√≥n de datos fiscales")
              echo "‚Ä¢ Validar con contabilidad"
              echo "‚Ä¢ Actualizar sistema fiscal"
              echo "‚Ä¢ Generar nuevos documentos"
              ;;
            "Actualizaci√≥n de datos de facturaci√≥n")
              echo "‚Ä¢ Verificar m√©todo de pago"
              echo "‚Ä¢ Actualizar sistema de billing"
              echo "‚Ä¢ Notificar al departamento financiero"
              ;;
            "Cambio en nivel de servicio")
              echo "‚Ä¢ Ajustar recursos asignados"
              echo "‚Ä¢ Actualizar SLA"
              echo "‚Ä¢ Programar reuni√≥n con cliente"
              ;;
            "Correcci√≥n de datos err√≥neos")
              echo "‚Ä¢ Verificar origen del error"
              echo "‚Ä¢ Implementar medidas preventivas"
              echo "‚Ä¢ Notificar al cliente si es necesario"
              ;;
          esac
